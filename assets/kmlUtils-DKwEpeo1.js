import{dw as I,eK as b,eL as w,eM as k,eN as v,d7 as x,H as E,dv as p,eO as G,eP as S,eQ as m,eR as d,a2 as M,eS as O}from"./index-BsG1MnkR.js";const F={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function H(s){const o=s.folders||[],r=o.slice(),t=new Map,n=new Map,u=new Map,y=new Map,c=new Map,f={esriGeometryPoint:n,esriGeometryPolyline:u,esriGeometryPolygon:y};(s.featureCollection?.layers||[]).forEach(e=>{const l=p(e);l.featureSet.features=[];const a=e.featureSet.geometryType;t.set(a,l);const g=e.layerDefinition.objectIdField;a==="esriGeometryPoint"?h(n,g,e.featureSet.features):a==="esriGeometryPolyline"?h(u,g,e.featureSet.features):a==="esriGeometryPolygon"&&h(y,g,e.featureSet.features)}),s.groundOverlays&&s.groundOverlays.forEach(e=>{c.set(e.id,e)}),o.forEach(e=>{e.networkLinkIds.forEach(l=>{const a=$(l,e.id,s.networkLinks);a&&r.push(a)})}),r.forEach(e=>{if(e.featureInfos){e.points=p(t.get("esriGeometryPoint")),e.polylines=p(t.get("esriGeometryPolyline")),e.polygons=p(t.get("esriGeometryPolygon")),e.mapImages=[];for(const l of e.featureInfos)switch(l.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const a=f[l.type].get(l.id);a&&e[F[l.type]]?.featureSet.features.push(a);break}case"GroundOverlay":{const a=c.get(l.id);a&&e.mapImages.push(a);break}}e.fullExtent=P([e])}});const i=P(r);return{folders:o,sublayers:r,extent:i}}function J(s,o,r,t){const n=k?.findCredential(s);s=v(s,{token:n?.token});const u=x.kmlServiceUrl;return E(u,{query:{url:s,model:"simple",folders:"",refresh:r!==0||void 0,outSR:JSON.stringify(o)},responseType:"json",signal:t})}function R(s,o,r=null,t=[]){const n=[],u={},y=o.sublayers,c=new Set(o.folders.map(f=>f.id));return y.forEach(f=>{const i=new s;if(r?i.read(f,r):i.read(f),t.length&&c.has(i.id)&&(i.visible=t.includes(i.id)),u[f.id]=i,f.parentFolderId!=null&&f.parentFolderId!==-1){const e=u[f.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers?.unshift(i)}else n.unshift(i)}),n}function h(s,o,r){r.forEach(t=>{s.set(t.attributes[o],t)})}function L(s,o){let r;return o.some(t=>t.id===s&&(r=t,!0)),r}function $(s,o,r){const t=L(s,r);return t&&(t.parentFolderId=o,t.networkLink=t),t}async function T(s,o,r,t){const n=s[o];if(!n)return[];const u=I.fromJSON(n.featureSet).features,y=n.layerDefinition,c=b(y.drawingInfo.renderer),f=w.fromJSON(n.popupInfo),i=[];for(const e of u){const l=await c.getSymbolAsync(e);e.symbol=l,e.popupTemplate=f,e.visible=!0;const a=r.sublayerById.get(t);e.origin=a.origin,i.push(e)}return i}function P(s){const o=G(S),r=G(S);for(const t of s){if(t.polygons?.featureSet?.features)for(const n of t.polygons.featureSet.features)m(o,n.geometry),d(r,o);if(t.polylines?.featureSet?.features)for(const n of t.polylines.featureSet.features)m(o,n.geometry),d(r,o);if(t.points?.featureSet?.features)for(const n of t.points.featureSet.features)m(o,n.geometry),d(r,o);if(t.mapImages)for(const n of t.mapImages)m(o,n.extent),d(r,o)}return O(r,S)?void 0:{xmin:r[0],ymin:r[1],zmin:r[2],xmax:r[3],ymax:r[4],zmax:r[5],spatialReference:M.WGS84}}export{P as I,R as S,T as b,H as d,J as g};
