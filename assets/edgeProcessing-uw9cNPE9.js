import{e as H}from"./deduplicate-Cv4Zu9E_.js";import{ca as O,gP as P,nt as E,ez as j,ck as q,fO as k,j7 as z}from"./index-BsG1MnkR.js";import{RegularEdgeInstancesLayout as D,SilhouetteEdgeInstancesLayout as Q,EdgeInputBufferLayout as G}from"./bufferLayouts-Dm7a64lM.js";function W(e,n,o){const i=n/3,a=new Uint32Array(o+1),u=new Uint32Array(o+1),m=(t,s)=>{t<s?a[t+1]++:u[s+1]++};for(let t=0;t<i;t++){const s=e[3*t],c=e[3*t+1],r=e[3*t+2];m(s,c),m(c,r),m(r,s)}let I=0,b=0;for(let t=0;t<o;t++){const s=a[t+1],c=u[t+1];a[t+1]=I,u[t+1]=b,I+=s,b+=c}const f=new Uint32Array(6*i),d=a[o],B=(t,s,c)=>{if(t<s){const r=a[t+1]++;f[2*r]=s,f[2*r+1]=c}else{const r=u[s+1]++;f[2*d+2*r]=t,f[2*d+2*r+1]=c}};for(let t=0;t<i;t++){const s=e[3*t],c=e[3*t+1],r=e[3*t+2];B(s,c,t),B(c,r,t),B(r,s,t)}const U=(t,s)=>{const c=2*t,r=s-t;for(let p=1;p<r;p++){const w=f[c+2*p],y=f[c+2*p+1];let l=p-1;for(;l>=0&&f[c+2*l]>w;l--)f[c+2*l+2]=f[c+2*l],f[c+2*l+3]=f[c+2*l+1];f[c+2*l+2]=w,f[c+2*l+3]=y}};for(let t=0;t<o;t++)U(a[t],a[t+1]),U(d+u[t],d+u[t+1]);const v=new Int32Array(3*i),N=(t,s)=>t===e[3*s]?0:t===e[3*s+1]?1:t===e[3*s+2]?2:-1,L=(t,s)=>{const c=N(t,s);v[3*s+c]=-1},V=(t,s,c,r)=>{const p=N(t,s);v[3*s+p]=r;const w=N(c,r);v[3*r+w]=s};for(let t=0;t<o;t++){let s=a[t];const c=a[t+1];let r=u[t];const p=u[t+1];for(;s<c&&r<p;){const w=f[2*s],y=f[2*d+2*r];w===y?(V(t,f[2*s+1],y,f[2*d+2*r+1]),s++,r++):w<y?(L(t,f[2*s+1]),s++):(L(y,f[2*d+2*r+1]),r++)}for(;s<c;)L(t,f[2*s+1]),s++;for(;r<p;)L(f[2*d+2*r],f[2*d+2*r+1]),r++}return v}const _=.7;let R=class{updateSettings(n){this.settings=n,this._edgeHashFunction=n.reducedPrecision?K:J}write(n,o,i){A.seed=this._edgeHashFunction(i);const a=A.getIntRange(0,255),u=A.getIntRange(0,this.settings.variants-1),m=A.getFloat(),I=255*(.5*T(-(1-Math.min(m/_,1))+Math.max(0,m-_)/(1-_),1.2)+.5);n.position0.setVec(o,i.position0),n.position1.setVec(o,i.position1),n.componentIndex.set(o,i.componentIndex),n.variantOffset.set(o,a),n.variantStroke.set(o,u),n.variantExtension.set(o,I)}};const g=new Float32Array(6),h=new Uint32Array(g.buffer),$=new Uint32Array(1);function J(e){return g[0]=e.position0[0],g[1]=e.position0[1],g[2]=e.position0[2],g[3]=e.position1[0],g[4]=e.position1[1],g[5]=e.position1[2],$[0]=31*(31*(31*(31*(31*(166811+h[0])+h[1])+h[2])+h[3])+h[4])+h[5],$[0]}function K(e){const n=g;n[0]=x(e.position0[0]),n[1]=x(e.position0[1]),n[2]=x(e.position0[2]),n[3]=x(e.position1[0]),n[4]=x(e.position1[1]),n[5]=x(e.position1[2]),$[0]=5381;for(let o=0;o<h.length;o++)$[0]=31*$[0]+h[o];return $[0]}const C=1e4;function x(e){return Math.round(e*C)/C}function T(e,n){return Math.abs(e)**n*Math.sign(e)}class X{constructor(){this._commonWriter=new R}updateSettings(n){this._commonWriter.updateSettings(n)}allocate(n){return D.createBuffer(n)}write(n,o,i){this._commonWriter.write(n,o,i),O(S,i.faceNormal0,i.faceNormal1),P(S,S);const{typedBuffer:a,typedBufferStride:u}=n.normalCompressed;E(a,o,S[0],S[1],S[2],u)}}class Y{constructor(){this._commonWriter=new R}updateSettings(n){this._commonWriter.updateSettings(n)}allocate(n){return Q.createBuffer(n)}write(n,o,i){this._commonWriter.write(n,o,i);{const{typedBuffer:a,typedBufferStride:u}=n.normalCompressed;E(a,o,i.faceNormal0[0],i.faceNormal0[1],i.faceNormal0[2],u)}{const{typedBuffer:a,typedBufferStride:u}=n.normal2Compressed;E(a,o,i.faceNormal1[0],i.faceNormal1[1],i.faceNormal1[2],u)}}}const S=q(),A=new j;function rt(e){const n=Z(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return M.updateSettings(e.writerSettings),F.updateSettings(e.writerSettings),z(n,M,F)}function Z(e,n,o,i){if(n){const m=W(o,i,e.count);return new tt(o,i,m,e)}const a=H(e.buffer,e.stride/4,{originalIndices:o}),u=W(a.indices,i,a.uniqueCount);return{faces:a.indices,facesLength:a.indices.length,neighbors:u,vertices:G.createView(a.buffer)}}class tt{constructor(n,o,i,a){this.faces=n,this.facesLength=o,this.neighbors=i,this.vertices=a}}const M=new X,F=new Y,it=k().vec3f("position0").vec3f("position1"),ct=k().vec3f("position0").vec3f("position1").u16("componentIndex");export{rt as extract,ct as extractComponentsEdgeLocationsLayout,Z as extractEdgeInformation,it as extractEdgeLocationsLayout};
