import{n as i,p as n,u as v,e as x,ey as E,aT as $,i as F,dg as D,c2 as m}from"./index-BsG1MnkR.js";import{a as I}from"./rasterFieldUtils-Jd5pWEQ2.js";import{i as N}from"./timeSupport-wCYyBt7J.js";import{j as S,I as T}from"./rasterProjectionHelper-DIP8aTtz.js";const q=c=>{const y=c;let e=class extends y{constructor(...s){super(...s),this.view=null}get timeExtent(){return N(this.layer,this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(s,l){const{layer:t}=this;if(!s)throw new x("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t});const{popupEnabled:d}=t,p=E(t,l);if(!d||p==null)return[];const w=await p.getRequiredFields(null,{index:new $(t.rasterFields),partitions:new Map([["$pixel",t.rasterFields.filter(a=>a.name.startsWith(I)).map(a=>a.name)],["$imageCollectionItem",t.fields.map(a=>a.name)]])});F(l);const r=new D;r.timeExtent=this.timeExtent,r.geometry=s,r.outFields=w,r.outSpatialReference=s.spatialReference;const{resolution:o,spatialReference:u}=this.view,h=this.view.type==="2d"?new m(o,o,u):new m(.5*o,.5*o,u),{returnTopmostRaster:f,showNoDataRecords:R}=p.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},g={returnDomainValues:!0,returnTopmostRaster:f,pixelSize:h,showNoDataRecords:R,signal:l?.signal};return t.queryVisibleRasters(r,g)}async getSourceScale(){return await S(),await this.layer.load(),T(this.layer.serviceRasterInfo,this.view.spatialReference)}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return i([n()],e.prototype,"layer",void 0),i([n()],e.prototype,"suspended",void 0),i([n({readOnly:!0})],e.prototype,"timeExtent",null),i([n()],e.prototype,"view",void 0),e=i([v("esri.views.layers.ImageryLayerView")],e),e};export{q as y};
